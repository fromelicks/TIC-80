name: Create Release

on:
  workflow_dispatch: # This allows manual triggering of the workflow
    inputs:
      tag_name:
        description: 'Tag for the release (e.g., v1.0.0)'
        required: true
      release_title:
        description: 'Title of the release'
        required: true
      release_notes:
        description: 'Release notes or changelog'
        required: false

jobs:
  create-release:
    name: Create GitHub Release
    runs-on: ubuntu-latest

    steps:
      - name: Download Windows Artifact
        uses: actions/download-artifact@v4 # Updated version
        with:
          name: tic80-windows
          path: ./artifacts/windows
      - name: Create GitHub Release
        id: create_release
        uses: actions/github-script@v6
        with:
          script: |
            const { tag_name, release_title, release_notes } = github.event.inputs;
            const release = await github.rest.repos.createRelease({
              owner: context.repo.owner,
              repo: context.repo.repo,
              tag_name: tag_name,
              name: release_title,
              body: release_notes || '',
              draft: false,
              prerelease: false
            });
            return release.data.upload_url;
          result-encoding: json

      - name: Upload Windows Artifact to Release
        uses: actions/upload-release-asset@v1
        with:
          upload_url: ${{ steps.create_release.outputs.result }}
          asset_path: ./artifacts/windows/tic80-windows.zip
          asset_name: tic80-windows.zip
          asset_content_type: application/zip
          asset_path: ./artifacts/html/tic80-html.zip
          asset_name: tic80-html.zip
          asset_content_type: application/zip
